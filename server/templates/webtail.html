<br />
<style>
#logstream {
    overflow-x:hidden;
    overflow-y:visible;
    background-color: #fdfaff;
    border: 1px solid #adadfd;
    font-family:"Helvetica Narrow","Arial Narrow",Courier;
}
</style>
<a class="btn btn-default" id='idState' onclick="togglePause()" >Pause</a>
<a class="btn btn-default" onclick="clearLog()">Clear</a>
<a class="btn btn-default" onclick="showSettingsModal()">Settings...</a>
<br />
<br />
<div id="logstream"></div>

<script>
$(document).ready(function() {
    adjust();
});

$(window).on('resize', function() {
    adjust();
});

function adjust()
{
    var logw = $('#logstream');
    var logheight = $('#page-wrapper').outerHeight() - logw.offset().top;
    logw.height(logheight);
}

g_autoScroll = 1;
g_scrollState = ['Follow','Pause'];
function togglePause()
{
    g_autoScroll = 1 - g_autoScroll;
    if (g_autoScroll) {
        var elem = document.getElementById('logstream');
        elem.scrollTop = elem.scrollHeight;
    }
    $('#idState').html( g_scrollState[ g_autoScroll ] );
}

function clearLog()
{
    $('#logstream').html('');
}

function write_line(str)
{
    var packet = JSON.parse(str);
    var line = packet.l.replace(/\n/g, "<br />");
    line = packet.t + ':' + line;
    var stream = document.getElementById('logstream');

    stream.innerHTML += line;
    if (g_autoScroll)
        stream.scrollTop = stream.scrollHeight;
}

function showSettingsModal()
{
}

var single = "wsock_exists";

var conn = {
    onConnectAck : function(stat) {
        console.log("onConnectAck, status="+stat)
        if (stat == 'error') {
            UI.del_global(single);
        }
        //conn.send("hello from client")
    },
    onData : function(data) {
        //console.log("received:"+data);
        write_line(data);
    },
    onClose : function() {
        //debugger;
        UI.del_global(single);
        console.log("received onClose");
    }
};

$(document).ready(function() {
    if (UI.get_global(single)) {
        return;
    }

    UI.request_connection("webtail", conn)
    UI.set_global(single, 1);

})
</script>
